# Makefile.in

.PHONY: all BASIC clean

# TODO: replace with Autoconf macro substitution.
WRF_HYDRO_RAPID = 0

include global.mk

all: libHYDRO.a
	if [ ! -d "Run" ]; then \
	   (mkdir Run); \
	fi
	if [ -d "LandModel_cpl" ]; then \
	   (cd LandModel_cpl; make); \
	fi
	if [ $(WRF_HYDRO_RAPID) -eq 1 ]; then \
	   (cd lib; rm -f librapid.a); \
	fi
	if [ $(WRF_HYDRO_RAPID) -eq 1 ]; then \
	   (cd Rapid_routing; make -f makefile.cpl rapid); \
	fi
	if [ -d "LandModel" ]; then \
	   (cd LandModel; make; rm -f ../../Run/wrf_hydro.exe; \
	    mv run/hrldas.exe ../../Run/wrf_hydro.exe); \
	fi

libHYDRO.a:
	cd MPP && make
	cd Data_Rec && make
	cd Routing && make
	cd HYDRO_drv && make
	ar -r $@ $(addprefix MPP/,$(MPP_objects)) \
                 $(addprefix Data_Rec/,$(Data_Rec_objects)) \
                 $(addprefix Routing/,$(Routing_objects)) \
	         $(addprefix HYDRO_drv/,$(HYDRO_drv_objects))

clean:
	if [ -d "LandModel_cpl" ]; then \
	   (cd LandModel_cpl; make clean) \
	fi
	rm -f lib/*.a CPL/*/*.o CPL/*/*.mod
	if [ -d "LandModel" ]; then \
	   (cd LandModel; make clean) \
	fi
	if [ $(WRF_HYDRO_RAPID) -eq 1 ]; then \
	   (cd Rapid_routing; make -f makefile.cpl clean); \
	fi
	rm -rf */*.mod */*.o libHYDRO.a Run *~

