# Makefile.in

CPP = @CPP@
CPPFLAGS = @CPPFLAGS@
NETCDF4_CFLAGS = @NETCDF4_CFLAGS@

FC = @FC@
FCFLAGS = @FCFLAGS@

objects = \
  $(addsuffix .o, \
	CPL_WRF mpp_land module_mpp_ReachLS module_mpp_GWBUCKET)

all: ../lib/libHYDRO.a

# TODO: move "ar" command below to ../Makefile.in or
# ../lib/Makefile.in?

../lib/libHYDRO.a: $(objects)
	ar -r $@ $?

mpp_land.o module_mpp_ReachLS.o module_mpp_GWBUCKET.o: %.o: %.F
	$(FC) $(FCFLAGS) $(LDFLAGS) -c $<

# commands here are a bit odd, but we're trying to preserve the former
# build sequence where possible
CPL_WRF.o: CPL_WRF.f
	$(FC) -o $@ $(FCFLAGS) $(LDFLAGS) -I../mod $<
	$(FC) $(FCFLAGS) $(LDFLAGS) -c $(*).F

CPL_WRF.f: CPL_WRF.F
	$(CPP) $(CPPFLAGS) $(NETCDF4_CFLAGS) $< > $@

clean:
	rm -f *.o *.f *.mod *.s *.stb *~
