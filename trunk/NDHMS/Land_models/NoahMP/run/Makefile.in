# Makefile.in

include ../../../global.mk

.PHONY: all NoahMP clean

CPP = @CPP@
CPPFLAGS = @CPPFLAGS@
DEFS = @DEFS@
LDFLAGS = @LDFLAGS@
NETCDF4_LIBS = @NETCDF4_LIBS@

MPIFC = @MPIFC@
FCFLAGS = @FCFLAGS@
NETCDF4_FLIBS = @NETCDF4_FLIBS@

# TODO: where are TAO_DIR et al defined in the previous system?
ifeq ($(WRF_HYDRO_RAPID),1)
  include ${TAO_DIR}/bmake/tao_common
  PHDF5_INC = -I ${TACC_HDF5_INC}
  RAPID_MACRO = ${TAO_FORTRAN_LIB} ${TAO_LIB} ${PETSC_LIB} ${PHDF5_INC} \
        -Wl,-rpath,${TACC_HDF5_LIB} -L${TACC_HDF5_LIB} -lhdf5 -lz 
  RAPID_LIB =  -lrapid
else
  RAPID_MACRO = 
  RAPID_LIB =  
endif

NoahMP_objects = ../IO_code/module_NoahMP_hrldas_driver.o 

# TODO: all of these paths are relatively strange
objects = ../IO_code/main_hrldas_driver.o				\
  ../IO_code/module_hrldas_netcdf_io.o ../phys/module_sf_noahmpdrv.o	\
  ../phys/module_sf_noahmplsm.o ../phys/module_sf_noahmp_glacier.o	\
  ../phys/module_sf_noahmp_groundwater.o				\
  ../Utility_routines/module_wrf_utilities.o				\
  ../Utility_routines/module_model_constants.o				\
  ../Utility_routines/module_date_utilities.o				\
  ../Utility_routines/kwm_string_utilities.o				\
  ../../../HYDRO_drv/module_HYDRO_drv.o

all: hrldas.exe

# default we create the exe based on NoahMP
#  $(HYDRO_LIB) $(RAPID_LIB) $(NETCDFLIB) $(RAPID_MACRO) $(LDFLAGS) $(LIBS)
hrldas.exe: $(objects)
	$(MPIFC) -o $@ ../IO_code/main_hrldas_driver.o \
          -L../../.. -lHYDRO $(NETCDF4_FLIBS)

# Template to create the exe file based on different land model. Such as NoahMP
#   $(HYDRO_LIB) $(NETCDFLIB) $(LDFLAGS) $(LIBS)
NoahMP: $(objects)
	$(MPIFC) -o hrldas.exe -I../IO_code -I../phys $(objects)	\
	$(NoahMP_objects) ../../../libHYDRO.a $(NETCDF4_FLIBS)

clean:
	rm -f *~ hrldas.exe
