# Makefile.in

include ../../../global.mk

.PHONY: all NoahMP clean

CPP = @CPP@
CPPFLAGS = $(strip @CPPFLAGS@)
DEFS = @DEFS@
LDFLAGS = $(strip @LDFLAGS@)

MPIFC = @MPIFC@
FCFLAGS = $(strip @FCFLAGS@)
NETCDF4_LDFLAGS = @NETCDF4_LDFLAGS@
NETCDF4_FLIBS = @NETCDF4_FLIBS@

ifeq ($(WRF_HYDRO_RAPID),1)
  # TODO:
  include ${TAO_DIR}/bmake/tao_common
  PHDF5_INC = -I ${TACC_HDF5_INC}
  RAPID_MACRO = ${TAO_FORTRAN_LIB} ${TAO_LIB} ${PETSC_LIB} ${PHDF5_INC} \
        -Wl,-rpath,${TACC_HDF5_LIB} -L${TACC_HDF5_LIB} -lhdf5 -lz 
  RAPID_LIB =  -lrapid
else
  RAPID_MACRO = 
  RAPID_LIB =  
endif

NoahMP_objects = ../IO_code/module_NoahMP_hrldas_driver.o 

# TODO: all of these paths are relatively strange
objects = ../IO_code/main_hrldas_driver.o				\
  ../IO_code/module_hrldas_netcdf_io.o ../phys/module_sf_noahmpdrv.o	\
  ../phys/module_sf_noahmplsm.o ../phys/module_sf_noahmp_glacier.o	\
  ../phys/module_sf_noahmp_groundwater.o				\
  ../Utility_routines/module_wrf_utilities.o				\
  ../Utility_routines/module_model_constants.o				\
  ../Utility_routines/module_date_utilities.o				\
  ../Utility_routines/kwm_string_utilities.o				\
  ../../../HYDRO_drv/module_HYDRO_drv.o

all: hrldas.exe

hrldas.exe: $(objects)
	$(MPIFC) -o $@ ../IO_code/main_hrldas_driver.o \
                 -L../../.. -lHYDRO \
                 $(NETCDF4_LDFLAGS) $(NETCDF4_FLIBS)

NoahMP: $(objects)
	$(MPIFC) -o hrldas.exe -I../IO_code -I../phys $(objects)	\
	         $(NoahMP_objects) ../../../libHYDRO.a $(NETCDF4_FLIBS)

clean:
	rm -f *~ hrldas.exe
