# Makefile.in

.PHONY: all clean

CPP = @CPP@
CPPFLAGS = @CPPFLAGS@ -D_HRLDAS_OFFLINE_
DEFS = @DEFS@

MPIFC = @MPIFC@
FCFLAGS = @FCFLAGS@
NETCDF4_CFLAGS = @NETCDF4_CFLAGS@

objects = module_NoahMP_hrldas_driver.o main_hrldas_driver.o	\
          module_hrldas_netcdf_io.o

all: $(objects)

main_hrldas_driver.o: %.o: %.f90
	$(MPIFC) -o $@ $(FCFLAGS) $<

module_NoahMP_hrldas_driver.o: %.o: %.f90 module_hrldas_netcdf_io.o		\
                               $(addprefix ../../../,\
                                 $(addprefix Land_models/NoahMP/,		\
                                   phys/module_sf_noahmp_groundwater.o		\
                                   Utility_routines/module_date_utilities.o)	\
                                 MPP/mpp_land.o Routing/module_NWM_io.o		\
                                 HYDRO_drv/module_HYDRO_drv.o			\
                                 Data_Rec/module_namelist.o)
	$(MPIFC) -o $@ $(FCFLAGS) $(addprefix -I../../../,$(addprefix	\
          Land_models/NoahMP/,phys Utility_routines) MPP Routing	\
          HYDRO_drv Data_Rec) $<

# TODO: prerequisites probably need additions here
module_hrldas_netcdf_io.o: %.o: %.f90 \
                           ../../../Land_models/NoahMP/Utility_routines/module_date_utilities.o
	$(MPIFC) -o $@ $(FCFLAGS) \
          $(addprefix -I../../../,$(addprefix \
                           Land_models/NoahMP/,Utility_routines phys) MPP) $<

%.f90: %.F
	$(CPP) $(CPPFLAGS) $(DEFS) $(NETCDF4_CFLAGS) $< > $@

clean:
	rm -f *.o *.mod *.stb *~ *.f90
