# Makefile.in

.SUFFIXES:
.SUFFIXES: .o .F

MPIFC = @MPIFC@
FCFLAGS = @FCFLAGS@
CPP = @CPP@
CPPFLAGS = @CPPFLAGS@

WRF_HYDRO_NUDGING = @WRF_HYDRO_NUDGING@

MODINC = -I../Data_Rec -I../MPP

include ../global.mk

objects = $(Routing_objects)

all: $(objects)

.F.o:
	$(CPP) $(CPPFLAGS) $(NETCDF4_CFLAGS) $(*).F > $(*).f
	$(MPIFC) -o $(@) $(FCFLAGS) $(MODINC) $(NETCDF4_FFLAGS) $(*).f
# TODO:	ar -r ../lib/libHYDRO.a $(@)
# TODO:	cp *.mod ../mod

module_gw_gw2d.o: ../Data_Rec/module_gw_gw2d_data.o module_HYDRO_io.o module_gw_gw2d.f
	$(MPIFC) -o $(@) $(FCFLAGS) -I$(dir $<) $(*).f

module_gw_gw2d.f: module_gw_gw2d.F
	$(CPP) $(CPPFLAGS) -I../Data_Rec $< > $@

ifneq ($(WRF_HYDRO_NUDGING),1)
module_HYDRO_io.o:  module_HYDRO_utils.o \
	            module_date_utilities_rt.o \
                    ../Data_Rec/module_namelist.o \
	 	    ../Data_Rec/module_RT_data.o 
else 
module_HYDRO_io.o:  module_HYDRO_utils.o \
	            module_date_utilities_rt.o \
		    ../nudging/module_date_utils_nudging.o \
	            ../nudging/module_nudging_io.o \
                    ../Data_Rec/module_namelist.o \
	 	    ../Data_Rec/module_RT_data.o 
endif

module_NWM_io_dict: ../Data_Rec/module_namelist.o

module_NWM_io: module_HYDRO_utils.o \
               module_NWM_io_dict.o \
               module_HYDRO_io.o \
               module_date_utilities_rt.o \
               ../Data_Rec/module_namelist.o \
               ../Data_Rec/module_RT_data.o

module_HYDRO_utils.o: ../Data_Rec/module_namelist.o ../Data_Rec/module_RT_data.o

module_lsm_forcing.o: module_HYDRO_io.o 

ifneq ($(WRF_HYDRO_NUDGING),1)
module_RT.o: module_GW_baseflow.o \
	     module_HYDRO_utils.o \
             module_HYDRO_io.o \
             module_noah_chan_param_init_rt.o \
	     module_UDMAP.o \
	     ../Data_Rec/module_namelist.o \
	     ../Data_Rec/module_RT_data.o \
	     ../Data_Rec/module_gw_gw2d_data.o
else
module_RT.o: module_GW_baseflow.o \
	     module_HYDRO_utils.o \
             module_HYDRO_io.o \
             module_noah_chan_param_init_rt.o \
	     module_UDMAP.o \
	     ../Data_Rec/module_namelist.o \
	     ../Data_Rec/module_RT_data.o \
	     ../Data_Rec/module_gw_gw2d_data.o \
             ../nudging/module_date_utils_nudging.o \
             ../nudging/module_nudging_io.o
endif

module_GW_baseflow.o: module_GW_baseflow.F
	$(CPP) $(CPPFLAGS) -I../Data_Rec $(*).F > $(*).f
	$(MPIFC) -o $(@) $(FCFLAGS) $(*).f

module_UDMAP.o: ../Data_Rec/module_namelist.o ../Data_Rec/module_RT_data.o

ifneq ($(WRF_HYDRO_NUDGING),1)
module_channel_routing.o: module_UDMAP.o
else
module_channel_routing.o: module_UDMAP.o\
			  ../nudging/module_date_utils_nudging.o \
		          ../nudging/module_nudging_utils.o \
		  ../nudging/module_stream_nudging.o
endif

clean:	
	rm -f *.o *.mod *.stb *~ *.f
